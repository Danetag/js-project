<?php

/* Mobile redirect */

// Define application environment
defined('APPLICATION_ENV')
    || define('APPLICATION_ENV', (getenv('APPLICATION_ENV') ? getenv('APPLICATION_ENV') : 'production'));

$dir = "";

switch(APPLICATION_ENV)
{
    case "developmentapp"  : $dir = "{{dirnameApp}}" ; break;
    case "developmentdist" : $dir = "{{dirnameDist}}"; break;
    case "production"      : $dir = ""; break;
}


require_once $dir.'include_php/Mobile_Detect.php';
$detect = new Mobile_Detect;

$isMobile = $detect->isMobile();
$isTablet = $detect->isTablet();

if( $isTablet )
{

    $isMobile = false;

    if( $detect->isAndroidOS() )
        $isMobile = true;

}

/* LANG */

$lang = "en";

$browserLanguage = substr($_SERVER['HTTP_ACCEPT_LANGUAGE'], 0, 2);

switch ($browserLanguage){
    case "fr":
        //echo "PAGE FR";
        $lang = "fr";
        break;        
}

$baseURL = "http://" . $_SERVER['HTTP_HOST'];

?>
<!DOCTYPE html>
<!--[if lt IE 7]>      <html class="no-js lt-ie11 lt-ie10 lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie11 lt-ie10 lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie11 lt-ie10 lt-ie9"> <![endif]-->
<!--[if IE 9]>         <html class="no-js lt-ie11 lt-ie10"> <![endif]-->
<!--[if IE 10]>         <html class="no-js lt-ie11"> <![endif]-->
<!--[if gt IE 10]><!--> <html class="no-js" lang="{{lang}}"> <!--<![endif]-->
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <title>{{meta.title}}</title>
        <meta name="description" content="{{meta.description}}">

        <meta name="apple-mobile-web-app-title" content="" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=yes" />

        <meta content="{{lang}}" http-equiv="Content-Language"/>

        <meta name="author"    content="Danetag" />
        <meta name="copyright" content="Danetag" />
        <meta name="publisher" content="Danetag" />
        <meta name="format-detection" content="telephone=no">
        <meta name="apple-mobile-web-app-capable" content="yes"/>

        <!-- FB OPENGRAPH -->
        <meta property="og:title" content="" />
        <meta property="og:url" content="" />
        <meta property="og:description" content="" />
        <meta property="og:image" content="" />
        <meta property="og:site_name" content="" />

        <!-- GOOGLE PLUS -->
        <meta itemprop="name" content="" />
        <meta itemprop="description" content="" />

        <!-- Place favicon.ico and apple-touch-icon.png in the root directory -->
        <link rel="shortcut icon" type="image/gif" href="/img/favicon.gif" />
        <link rel="icon" type="image/gif" href="/img/favicon.gif" />

        <!--[if lte IE 10]>
            <script src="/img/ie6/warning.js"></script>
            <script>
                window.onload=function(){  
                    e("/img/ie6/"); 
                }
            </script>
        <![endif]-->

        <script type="text/javascript">

            document.documentElement.className ="has-js " + document.documentElement.className;

            var _redirectMobile = {
                isMobileFromUA : "<?php echo $isMobile; ?>",
                lang           : "<?php echo $lang; ?>",
                baseURL        : "<?php echo $$baseURL; ?>/",
                isMobile       : false
            }

            //JS redirection
            if ( _redirectMobile.isMobileFromUA ) /* Mobile */ 
               _redirectMobile.isMobile = true;

            if( _redirectMobile.isMobile )
            {
                window.location = _redirectMobile.baseURL + "m/?lang=" + _redirectMobile.lang;
            }  

        </script>

        <!-- CSS -->
        {{#each aCSS}}
            <link rel="stylesheet" href="{{src}}">
        {{/each}}

        <script src="/js/vendor/modernizr.custom.14441.js"></script>
        <script src="/js/vendor/detectizr.min.js"></script>

    </head>
    <body>

    <div id="loader"></div>

    <header id="header">
        <nav>
            <ul>
                {{#each menu}}
                     <li><a href="{{route}}">{{label}}</a></li>
                {{/each}}
            </ul>
        </nav>
    </header>

    <div id="content">